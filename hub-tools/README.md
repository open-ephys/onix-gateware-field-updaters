## Usage

To prepare and update firmware updates to ONIX headstages and hubs, follow these
steps:

### 1. Prepare your bitfile using `bf_prep`

```
bf_prep <hardware_id> <min_hardware_rev> <firmware_version> <input_bitfile> <output_file>
```
Where,

- `hardware_id`: ONIX hardware ID in hex format
- `min_hardware_rev`: Minimum hardware version required to accept the new
   firmware version in hex format
- `firmware_version`: The version of the firmware being prepared in hex format

For example,

```
bf_prep 0004 0200 0005 headstage_rhs2116.bit headstage_rhs2116.onix
```

Creates a ONI hub bitfile for ONIX Hardware ID 0004 (Rhs2116 headsteage).
Hardware revision 2.0 (rev. B) or higher is requred. The firmware version
that we are preparing for this update is 5.0.

### 2. Prepare your bitfile using `hub-programmer`

Using the .onix file produced in step 1, program the new firmware onto the hub:

```
hub_programmer <driver> <slot> <hub index> <binary_image>
```

- driver: Hardware driver to dynamically link (e.g. riffa, ft600, test, etc.)
- slot: Index specifying the physical slot occupied by hardware being controlled.
- binary_image: File generated by bf_prep

> [!NOTE]
> The headstage must be powered on and locked in order for this to work. This can
> be done manually using e.g. `oni-repl`.

### 3. Verify the firmware using `oni-repl`

After power cycling the headstage, use `oni-repl` to verify the update was
succesful using the `H` command.